"use strict";var _createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}();function _asyncToGenerator(e){return function(){var c=e.apply(this,arguments);return new Promise(function(r,s){return function t(e,n){try{var a=c[e](n),i=a.value}catch(e){return void s(e)}if(!a.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var login=getCookie("denlu");login||(localStorage.setItem("url",location.href),location.href="../html/denlu.html");var Car=function(){function n(e,t){_classCallCheck(this,n),this.ele=document.querySelector(e),this.username=t,this.info={number:0,totalPrice:0},this.init()}var e;return _createClass(n,[{key:"init",value:function(){var n=this;this.body=this.ele.querySelector(".panel-body"),this.species=this.ele.querySelector(".species"),this.number=this.ele.querySelector(".number"),this.total=this.ele.querySelector(".total"),this.allChecked=this.ele.querySelector(".allChecked"),this.getData(),this.ele.onclick=function(e){var t=e.target;n.id=t.getAttribute("idx"),t.classList.contains("checked")&&(n.data.forEach(function(e){e.id==n.id&&(e.is_select=t.checked)}),n.calculation()),t.classList.contains("allChecked")&&(n.data.forEach(function(e){e.is_select=t.checked}),n.render()),t.classList.contains("reduce")&&n.reduce(),t.classList.contains("add")&&n.add(),t.classList.contains("del")&&n.remove(n.id),t.classList.contains("settlement")&&n.data.filter(function(e){return 1==e.is_select}).forEach(function(e){n.remove(e.id)})}}},{key:"getData",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pAjax({url:"../api/getcardata.php",data:{username:this.username}});case 2:t=e.sent,this.data=JSON.parse(t),console.log(this.data),this.data.forEach(function(e){e.is_select=!1}),this.render();case 7:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"render",value:function(){this.calculation();var a="";this.data.forEach(function(e){var t=e.price.split("￥")[1],n=e.num*t;a+='<div class="media">\n                    <div class="media-left">\n                        <a href="#" class="media_left">\n                            <input type="checkbox" '+(e.is_select?"checked":"")+' class="checked" idx="'+e.id+'">\n                            <img class="media-object" style="width: 100px;"\n                                src="'+e.logo+'"\n                                alt="...">\n                        </a>\n                    </div>\n                    <div class="media-body">\n                        <div class="media_body_left">\n                            <h4 class="media-heading">'+e.name+'</h4>\n                            <div class="price">\n                                <i class="glyphicon glyphicon-yen"></i>\n                                <span>'+t+'</span>\n                            </div>\n                        </div>\n                        <div class="media_body_center">\n                            <div class="btn-group" role="group" aria-label="...">\n                                <button type="button" class="btn btn-default reduce" idx="'+e.id+'">-</button>\n                                <button type="button" class="btn btn-default">'+e.num+'</button>\n                                <button type="button" class="btn btn-default add" idx="'+e.id+'">+</button>\n                            </div>\n                        </div>\n                        <div class="media_body_right">\n                            <span class="item_total">小计:￥'+n.toFixed(2)+'</span>\n                            <span idx="'+e.id+'" class="glyphicon glyphicon-remove del"></span>\n                        </div>\n                    </div>\n                </div>'}),this.body.innerHTML=a}},{key:"calculation",value:function(){this.selectData=this.data.filter(function(e){return 1==e.is_select}),this.info.number=this.selectData.reduce(function(e,t){return e+ +t.num},0),this.info.totalPrice=this.selectData.reduce(function(e,t){return e+t.num*t.price.split("￥")[1]},0);var e=this.data.every(function(e){return 1==e.is_select});this.species.innerHTML=this.data.length,this.number.innerHTML=this.info.number,this.total.innerHTML=this.info.totalPrice,this.allChecked.checked=e}},{key:"reduce",value:function(){var t=this,n=this.data.find(function(e){return e.id==t.id}).num;n<=1?alert("商品数量最小为1"):pAjax({url:"../api/updatacar.php",data:{id:this.id,num:--n,username:this.username}}).then(function(e){(e=JSON.parse(e)).code&&t.data.forEach(function(e){e.id==t.id&&(e.num=n,t.render())})})}},{key:"add",value:function(){var t=this,n=this.data.find(function(e){return e.id==t.id}).num;pAjax({url:"../api/updataCar.php",data:{id:this.id,num:++n,username:this.username}}).then(function(e){(e=JSON.parse(e)).code&&t.data.forEach(function(e){e.id==t.id&&(e.num=n,t.render())})})}},{key:"remove",value:function(t){var n=this;pAjax({url:"../api/deleteCar.php",data:{username:this.username,id:t}}).then(function(e){(e=JSON.parse(e)).code&&(n.data=n.data.filter(function(e){return e.id!=t}),n.render())})}}]),n}();new Car(".container",login);var ul=document.querySelector(".cate ul"),cate=document.querySelector(".cate");cate.onmouseover=function(){ul.style.display="block"},cate.onmouseout=function(){ul.style.display="none"};